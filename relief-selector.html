<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relief Contracting — Palette Visualizer (Locked Layout)</title>
<style>
  :root{
    --brand:#0d2a44; --ink:#111; --muted:#6b7280; --panel:#f7f9fc; --line:#e5e7eb;
  }
  html,body{margin:0;background:#fff;color:var(--ink);font:14px/1.45 system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1200px;margin:22px auto;padding:0 14px}
  h1{margin:0 0 10px;font-size:20px;color:var(--brand)}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:14px}
  @media (max-width:1000px){.grid{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}
  .section{margin-top:8px}
  .section>div:first-child{font-weight:800;color:#0f172a;margin-bottom:6px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .swatches{display:flex;gap:8px;flex-wrap:wrap}
  .swatch{width:28px;height:28px;border:1px solid #c7c9cf;border-radius:6px;cursor:pointer}
  .swatch.is-active{outline:2px solid #a48d32;outline-offset:2px}
  .tile{width:56px;height:38px;border:1px solid #c7c9cf;border-radius:6px;cursor:pointer;background:#ddd}
  .tile.is-active{outline:2px solid #a48d32;outline-offset:2px}
  .dooropt{display:flex;gap:8px}
  .dooropt button{cursor:pointer;border:1px solid #c7c9cf;background:#fff;border-radius:10px;padding:6px 8px;display:flex;align-items:center;gap:8px}
  .dooropt button.active{outline:2px solid #a48d32}
  .dooropt img{width:40px;height:56px;object-fit:cover;border-radius:6px;border:1px solid #d1d5db}
  .tools{display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#eef2ff;color:#1f2937}
  .small{font-size:12px;color:var(--muted)}
  .stage{background:#fff;border:1px solid var(--line);border-radius:12px;min-height:620px;display:flex;align-items:center;justify-content:center}
  textarea,input{border:1px solid #cfd4dc;border-radius:8px;padding:8px 10px}
  textarea{width:100%;min-height:70px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Relief Contracting — Kitchen Colour Palette Visualizer</h1>

  <div class="grid">
    <!-- LEFT: Controls -->
    <div class="card">
      <div class="section">
        <div>Door style (2 options)</div>
        <div class="dooropt">
          <button id="optShaker" class="active" data-style="shaker" title="Shaker">
            <!-- miniature preview drawn by CSS; image placeholders kept for clarity -->
            <svg width="40" height="56" viewBox="0 0 40 56" style="border-radius:6px;border:1px solid #d1d5db">
              <rect x="0.5" y="0.5" width="39" height="55" fill="#eee" stroke="#c9ccd1"/>
              <rect x="6" y="8" width="28" height="40" rx="2" ry="2" fill="#e6e6e6" stroke="#c9ccd1"/>
            </svg>
            <span>Shaker</span>
          </button>
          <button id="optSlab" data-style="slab" title="Slab">
            <svg width="40" height="56" viewBox="0 0 40 56" style="border-radius:6px;border:1px solid #d1d5db">
              <rect x="0.5" y="0.5" width="39" height="55" fill="#eee" stroke="#c9ccd1"/>
            </svg>
            <span>Slab</span>
          </button>
        </div>
      </div>

      <div class="section">
        <div>Cabinet colour</div>
        <div id="cabSwatches" class="swatches"></div>
      </div>

      <div class="section">
        <div>Wall paint</div>
        <div id="wallSwatches" class="swatches"></div>
      </div>

      <div class="section">
        <div>Backsplash</div>
        <div id="splashTiles" class="swatches"></div>
      </div>

      <div class="section">
        <div>Countertop (Caesarstone)</div>
        <div id="topTiles" class="swatches"></div>
      </div>

      <div class="section">
        <div>Flooring</div>
        <div id="floorTiles" class="swatches"></div>
        <div class="small">Patterns are illustrative; final jobs use real samples.</div>
      </div>

      <div class="section">
        <div>Send your selection</div>
        <div class="row">
          <input id="cName" placeholder="Full name" style="flex:1">
          <input id="cEmail" placeholder="Email" style="flex:1">
        </div>
        <textarea id="cNotes" placeholder="Anything we should know?"></textarea>
        <div class="tools">
          <button class="btn" id="submitBtn">Submit (Email Us)</button>
          <button class="btn secondary" id="downloadBtn">Download PNG</button>
          <button class="btn secondary" id="copyBtn">Copy Summary</button>
        </div>
        <div class="small">Submit downloads a snapshot and opens your email to <b>info@reliefcontracting.ca</b>. Attach the image.</div>
      </div>
    </div>

    <!-- RIGHT: Stage -->
    <div class="stage">
      <svg id="scene" width="1024" height="620" viewBox="0 0 1024 620" role="img" aria-label="Kitchen Preview"></svg>
    </div>
  </div>
</div>

<script>
/* ========= STATE ========= */
const state = {
  style: 'shaker',
  cab: '#e7e6e3',
  wall: '#eef0f3',
  splash: 'white_subway',
  top: 'calacatta',
  floor: 'oak_light',
  // contact
  cName:'', cEmail:'', cNotes:''
};

/* ========= SWATCH SETS ========= */
const CABINET_COLOURS = [
  {name:'White', code:'#f2f3f4'},
  {name:'Warm White', code:'#efeae3'},
  {name:'Light Grey', code:'#d8dde2'},
  {name:'Greige', code:'#d9d3c9'},
  {name:'Navy', code:'#0f2746'},
  {name:'Forest', code:'#213a33'},
  {name:'Charcoal', code:'#2b3138'},
  {name:'Black', code:'#111111'}
];
const WALL_COLOURS = [
  {name:'White', code:'#f7f8fa'},
  {name:'Pale Grey', code:'#edf1f5'},
  {name:'Soft Greige', code:'#eee8df'},
  {name:'Warm Taupe', code:'#e9e0d8'}
];

/* ========= SVG HELPERS ========= */
const svg = document.getElementById('scene');
function clearSVG(){ while(svg.firstChild) svg.removeChild(svg.firstChild); }
function rect(x,y,w,h,fill,stroke='none',sw=1,rx=0){ const r=el('rect',{x,y,width:w,height:h,fill,stroke,'stroke-width':sw,rx}); svg.appendChild(r); return r; }
function line(x1,y1,x2,y2,stroke='#000',sw=1,op=1){ const l=el('line',{x1,y1,x2,y2,stroke,'stroke-width':sw,opacity:op}); svg.appendChild(l); return l; }
function el(tag,attrs){ const e=document.createElementNS('http://www.w3.org/2000/svg',tag); for(const k in attrs){ if(attrs[k]!=null) e.setAttribute(k,attrs[k]); } return e; }
function ensureDefs(){ let d=svg.querySelector('defs'); if(!d){ d=el('defs',{}); svg.appendChild(d); } return d; }
function shade(hex,percent){ const f=parseInt(hex.slice(1),16),t=percent<0?0:255,p=Math.abs(percent)/100,R=f>>16,G=f>>8&0x00FF,B=f&0x0000FF,to=v=>Math.round((t - v)*p)+v; return `#${(1<<24|to(R)<<16|to(G)<<8|to(B)).toString(16).slice(1)}`; }

/* ========= PATTERNS (procedural; simple + fast) ========= */
/* Subway tile pattern */
function patternSubway(id, grout='#dcdcdc', tile='#f3f4f6', dark=false){
  const d=ensureDefs(); if(d.querySelector('#'+id)) return;
  const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:64,height:32});
  const bg=el('rect',{x:0,y:0,width:64,height:32,fill:tile}); pat.appendChild(bg);
  const g=el('g',{stroke:grout,'stroke-width':1,opacity: dark?0.4:0.9});
  // tile grid with half-offset rows
  for(let y=0;y<=32;y+=16) g.appendChild(el('line',{x1:0,y1:y,x2:64,y2:y}));
  for(let x=0;x<=64;x+=32) g.appendChild(el('line',{x1:x,y1:0,x2:x,y2:16}));
  for(let x=-32;x<=64;x+=32) g.appendChild(el('line',{x1:x,y1:16,x2:x+32,y2:16}));
  pat.appendChild(g); d.appendChild(pat);
}
/* Marble-ish counter (very light veining) */
function patternMarble(id, base='#f4f2ed', ve='#d7d2c7'){
  const d=ensureDefs(); if(d.querySelector('#'+id)) return;
  const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:200,height:64});
  pat.appendChild(el('rect',{x:0,y:0,width:200,height:64,fill:base}));
  const p=el('path',{d:'M0,48 C40,30 60,54 100,36 S160,30 200,40',stroke:ve,'stroke-width':2,fill:'none',opacity:.5});
  const p2=p.cloneNode(); p2.setAttribute('d','M0,20 C40,12 70,28 110,18 S170,22 200,14'); p2.setAttribute('opacity','.35');
  pat.appendChild(p); pat.appendChild(p2); d.appendChild(pat);
}
/* Speckled quartz */
function patternSpeckle(id, base='#f1efea'){
  const d=ensureDefs(); if(d.querySelector('#'+id)) return;
  const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:120,height:40});
  pat.appendChild(el('rect',{x:0,y:0,width:120,height:40,fill:base}));
  const g=el('g',{fill:'#bfbab0',opacity:.6}); for(let i=0;i<80;i++){ const x=Math.random()*120, y=Math.random()*40, r=Math.random()*1.5+0.3; g.appendChild(el('circle',{cx:x,cy:y,r})); }
  pat.appendChild(g); d.appendChild(pat);
}
/* Solid dark */
function patternSolid(id, color='#1d1f22'){ const d=ensureDefs(); if(d.querySelector('#'+id)) return; const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:10,height:10}); pat.appendChild(el('rect',{x:0,y:0,width:10,height:10,fill:color})); ensureDefs().appendChild(pat); }
/* Wood floor (simple planks) */
function patternWood(id, light=true){
  const d=ensureDefs(); if(d.querySelector('#'+id)) return;
  const base=light? '#d9c1a0' : '#6f4a38';
  const grain=light? '#b8946d' : '#5a3e31';
  const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:100,height:24});
  pat.appendChild(el('rect',{x:0,y:0,width:100,height:24,fill:base}));
  pat.appendChild(el('path',{d:'M0,12 H100',stroke:grain,'stroke-width':0.6,opacity:.6}));
  // plank seams
  for(let x=25;x<=100;x+=25) pat.appendChild(el('line',{x1:x,y1:0,x2:x,y2:24,stroke:grain,'stroke-width':1,opacity:.55}));
  d.appendChild(pat);
}
/* Charcoal square tile floor */
function patternSquareTile(id){ const d=ensureDefs(); if(d.querySelector('#'+id)) return; const pat=el('pattern',{id,patternUnits:'userSpaceOnUse',width:64,height:64}); pat.appendChild(el('rect',{x:0,y:0,width:64,height:64,fill:'#2e3236'})); for(let i=0;i<=64;i+=16){ pat.appendChild(el('line',{x1:i,y1:0,x2:i,y2:64,stroke:'#51565c','stroke-width':1})); pat.appendChild(el('line',{x1:0,y1:i,x2:64,y2:i,stroke:'#51565c','stroke-width':1})); } d.appendChild(pat); }

/* Build all base patterns once */
patternSubway('splash_white', '#d8dadf', '#f6f7fb', false);
patternSubway('splash_dark', '#a4a7ad', '#2d3136', true);
patternSubway('splash_marble_grid', '#d6d6d6', '#eef0f2', false);
patternMarble('top_calacatta', '#f4f2ed', '#cbc5bc');
patternMarble('top_frosty', '#f6f4ee', '#e3ddd1');
patternSpeckle('top_atlantic', '#ece9e4');
patternSolid('top_jet', '#16181b');
patternSolid('top_raven', '#3a3f45');
patternWood('floor_oak_light', true);
patternWood('floor_oak_dark', false);
patternSquareTile('floor_charcoal');

/* ========= RENDER ========= */
function drawDoor(x,y,w,h,style,fill){
  // Cabinet body
  rect(x, y, w, h, fill, 'rgba(0,0,0,.08)', 1, 3);
  if(style==='shaker'){
    const rail= Math.min(18, Math.max(10, w*0.06));
    const inner=el('rect',{x:x+rail,y:y+rail,width:w-rail*2,height:h-rail*2,rx:2,ry:2,fill:shade(fill,-7),stroke:'rgba(0,0,0,.15)','stroke-width':0.8});
    svg.appendChild(inner);
  }
  // simple handle
  svg.appendChild(el('rect',{x:x+w-8, y:y+h/2-16, width:3,height:32,rx:1.4, fill:'#b4b7bd'}));
}
function drawDrawer(x,y,w,h,fill){
  // face
  rect(x+4,y+4,w-8,h-8,fill,'rgba(0,0,0,.18)',1,3);
  // pull
  svg.appendChild(el('rect',{x:x+w/2-14, y:y+h/2-2, width:28, height:4, rx:2, fill:'#b4b7bd'}));
}
function drawRun(){
  clearSVG();
  const W=1024,H=620, margin=60;
  const wallH=420;
  // WALL
  rect(0,0,W,wallH, state.wall);
  // BACKSPLASH
  const splashTop = 210; // from top
  const splashBottom = 370; // just under the counter
  const splashFill = {
    'white_subway': 'url(#splash_white)',
    'basalt': 'url(#splash_dark)',
    'marble': 'url(#splash_marble_grid)'
  }[state.splash] || 'url(#splash_white)';
  rect(margin, splashTop, W - margin*2, splashBottom - splashTop, splashFill, 'rgba(0,0,0,.05)', 1, 2);

  // FLOOR
  const floorFill = {
    'oak_light': 'url(#floor_oak_light)',
    'oak_dark': 'url(#floor_oak_dark)',
    'charcoal_tile':'url(#floor_charcoal)',
    'white_tile':'url(#splash_white)'
  }[state.floor] || 'url(#floor_oak_light)';
  rect(0, wallH, W, H - wallH, floorFill);

  // BASE CABINET RUN (locked to reference)
  const avail = W - margin*2;
  const widthsIn = [36,28,30,18,27]; // L to R (stove = 30 slot)
  const totalIn = widthsIn.reduce((a,b)=>a+b,0);
  const pxPerIn = avail / totalIn;
  const gap=8;
  const cH = 220, toe=24;
  const counterY = 370;
  const cabY = counterY - cH;

  let x = margin;
  const face = state.cab;

  // 1) 36" double door
  let w = widthsIn[0]*pxPerIn;
  rect(x, cabY, w, cH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(x+6, cabY+8, (w-18)/2, cH-16, state.style, face);
  drawDoor(x+12+(w-18)/2, cabY+8, (w-18)/2, cH-16, state.style, face);
  x += w + gap;

  // 2) 28" drawer stack
  w = widthsIn[1]*pxPerIn;
  rect(x, cabY, w, cH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  const dH=(cH-28)/3;
  for(let i=0;i<3;i++) drawDrawer(x+6, cabY+8+i*(dH+6), w-12, dH, face);
  x += w + gap;

  // 3) Stove opening 30"
  w = widthsIn[2]*pxPerIn;
  // oven body
  const oven = el('g',{}); svg.appendChild(oven);
  oven.appendChild(el('rect',{x:x+8,y:cabY+36,width:w-16,height:cH-28,rx:6,fill:'#e1e3e6',stroke:'#aeb4bb'}));
  oven.appendChild(el('rect',{x:x+14,y:cabY+60,width:w-28,height:cH-70,rx:8,fill:'#222',stroke:'#666'}));
  // control
  oven.appendChild(el('rect',{x:x+10,y:cabY+20,width:w-20,height:20,rx:4,fill:'#cfd4da',stroke:'#aeb4bb'}));
  x += w + gap;

  // 4) 18" single door
  w = widthsIn[3]*pxPerIn;
  rect(x, cabY, w, cH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(x+6, cabY+8, w-12, cH-16, state.style, face);
  x += w + gap;

  // 5) 27" drawer stack
  w = widthsIn[4]*pxPerIn;
  rect(x, cabY, w, cH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  const dH2=(cH-28)/3;
  for(let i=0;i<3;i++) drawDrawer(x+6, cabY+8+i*(dH2+6), w-12, dH2, face);

  // Toe-kick
  rect(margin, cabY+cH-6, avail, toe, '#c9ccd1'); line(margin, cabY+cH-6, margin+avail, cabY+cH-6,'#a9adb5',1,.7);

  // Countertop across run
  const topFill = {
    'calacatta':'url(#top_calacatta)',
    'frosty':'url(#top_frosty)',
    'jet':'url(#top_jet)',
    'raven':'url(#top_raven)',
    'atlantic':'url(#top_atlantic)'
  }[state.top] || 'url(#top_calacatta)';
  rect(margin-6, counterY-14, avail+12, 16, topFill,'rgba(0,0,0,.25)',1,4);

  // UPPERS
  const uppY = 140, uppH = 160;
  const leftUppW = (36+28)*pxPerIn; // above first two bases
  const rightUppW = (18+27)*pxPerIn; // above last two bases
  // left uppers: two boxes
  const gapU=8;
  let ux = margin; const boxW=(leftUppW-gapU)/2;
  rect(ux, uppY, boxW, uppH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(ux+6, uppY+6, (boxW-18)/2, uppH-12, state.style, face);
  drawDoor(ux+12+(boxW-18)/2, uppY+6, (boxW-18)/2, uppH-12, state.style, face);
  ux += boxW + gapU;
  rect(ux, uppY, boxW, uppH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(ux+6, uppY+6, (boxW-18)/2, uppH-12, state.style, face);
  drawDoor(ux+12+(boxW-18)/2, uppY+6, (boxW-18)/2, uppH-12, state.style, face);

  // hood
  const hoodW = (30)*pxPerIn; const hoodX = margin + (36+28)*pxPerIn + gap + (hoodW-gap)/2;
  const hoodTopY = 88;
  rect(hoodX, hoodTopY, hoodW, 20, '#e8ecef','#cfd4da',1,2);
  svg.appendChild(el('polygon',{points:`${hoodX-40},${110} ${hoodX+hoodW+40},110 ${hoodX+hoodW},130 ${hoodX},130`, fill:'#e8ecef', stroke:'#cfd4da'}));

  // right uppers: two boxes
  ux = margin + (36+28+30)*pxPerIn + gap*3;
  const boxW2=(rightUppW-gapU)/2;
  rect(ux, uppY, boxW2, uppH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(ux+6, uppY+6, (boxW2-18)/2, uppH-12, state.style, face);
  drawDoor(ux+12+(boxW2-18)/2, uppY+6, (boxW2-18)/2, uppH-12, state.style, face);
  ux += boxW2 + gapU;
  rect(ux, uppY, boxW2, uppH, '#f7f7f7','rgba(0,0,0,.08)',1,3);
  drawDoor(ux+6, uppY+6, (boxW2-18)/2, uppH-12, state.style, face);
  drawDoor(ux+12+(boxW2-18)/2, uppY+6, (boxW2-18)/2, uppH-12, state.style, face);
}

/* ========= BUILD UI ========= */
function buildColourSwatches(containerId, list, key){
  const wrap=document.getElementById(containerId); wrap.innerHTML='';
  list.forEach((c,i)=>{
    const b=document.createElement('button'); b.className='swatch'; b.title=c.name; b.style.background=c.code;
    if(i===0 && key==='cab') b.classList.add('is-active');
    if(i===0 && key==='wall') b.classList.add('is-active');
    b.onclick=()=>{ state[key]=c.code; [...wrap.children].forEach(x=>x.classList.remove('is-active')); b.classList.add('is-active'); drawRun(); };
    wrap.appendChild(b);
  });
}
function buildTiles(containerId, options, key){
  const wrap=document.getElementById(containerId); wrap.innerHTML='';
  options.forEach((o,i)=>{
    const b=document.createElement('button'); b.className='tile'; b.title=o.label; b.style.background=o.preview;
    if(i===0) b.classList.add('is-active');
    b.onclick=()=>{ state[key]=o.value; [...wrap.children].forEach(x=>x.classList.remove('is-active')); b.classList.add('is-active'); drawRun(); };
    wrap.appendChild(b);
  });
}

/* Options (mapped to our patterns) */
const SPLASH_OPTS=[
  {label:'White Subway', value:'white_subway', preview:'linear-gradient(0deg,#f6f7fb 48%,#d8dadf 49%,#d8dadf 51%,#f6f7fb 52%)'},
  {label:'Basalt Subway', value:'basalt', preview:'linear-gradient(0deg,#2d3136 48%,#a4a7ad 49%,#a4a7ad 51%,#2d3136 52%)'},
  {label:'Marble Tile', value:'marble', preview:'linear-gradient(0deg,#eef0f2 48%,#d6d6d6 49%,#d6d6d6 51%,#eef0f2 52%)'}
];
const TOP_OPTS=[
  {label:'Calacatta Nuvo', value:'calacatta', preview:'linear-gradient(90deg,#f4f2ed,#efece6)'},
  {label:'Frosty Carrina', value:'frosty', preview:'linear-gradient(90deg,#f7f5ef,#f0ede6)'},
  {label:'Jet Black', value:'jet', preview:'linear-gradient(90deg,#1b1d20,#15171a)'},
  {label:'Raven', value:'raven', preview:'linear-gradient(90deg,#3a3f45,#30353a)'},
  {label:'Atlantic Salt', value:'atlantic', preview:'repeating-radial-gradient(#bfbab0,#ece9e4 8px)'}
];
const FLOOR_OPTS=[
  {label:'Light Oak', value:'oak_light', preview:'repeating-linear-gradient(90deg,#d9c1a0 0 25px,#cda982 25px 26px)'},
  {label:'Dark Oak', value:'oak_dark', preview:'repeating-linear-gradient(90deg,#6f4a38 0 25px,#5a3e31 25px 26px)'},
  {label:'Charcoal Tile', value:'charcoal_tile', preview:'repeating-linear-gradient(0deg,#2e3236 0 16px,#51565c 16px 17px)'},
  {label:'White Tile', value:'white_tile', preview:'repeating-linear-gradient(0deg,#f6f7fb 0 16px,#d8dadf 16px 17px)'}
];

/* Door style toggle */
document.getElementById('optShaker').onclick = (e)=>{ state.style='shaker'; e.currentTarget.classList.add('active'); document.getElementById('optSlab').classList.remove('active'); drawRun(); };
document.getElementById('optSlab').onclick   = (e)=>{ state.style='slab';   e.currentTarget.classList.add('active'); document.getElementById('optShaker').classList.remove('active'); drawRun(); };

/* Build controls */
buildColourSwatches('cabSwatches', CABINET_COLOURS, 'cab');
buildColourSwatches('wallSwatches', WALL_COLOURS, 'wall');
buildTiles('splashTiles', SPLASH_OPTS, 'splash');
buildTiles('topTiles', TOP_OPTS, 'top');
buildTiles('floorTiles', FLOOR_OPTS, 'floor');

/* Contact fields */
['cName','cEmail','cNotes'].forEach(id=>{ const el=document.getElementById(id); el.addEventListener('input',()=>{ state[id]=el.value; }); });

/* ========= EXPORT / EMAIL ========= */
function selectionSummary(){
  const name = (state.cName||'').trim(); const email=(state.cEmail||'').trim();
  return [
    `Door style: ${state.style}`,
    `Cabinet: ${state.cab}`,
    `Wall: ${state.wall}`,
    `Backsplash: ${state.splash}`,
    `Countertop: ${state.top}`,
    `Floor: ${state.floor}`,
    '',
    `Name: ${name}`,
    `Email: ${email}`,
    '',
    `Notes: ${(state.cNotes||'(none)').trim()}`
  ].join('\n');
}
function serializeSVGToPNG(done){
  const data = new XMLSerializer().serializeToString(svg);
  const blob = new Blob([data], {type:'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.onload = ()=>{
    const canvas=document.createElement('canvas');
    canvas.width = svg.viewBox.baseVal.width || svg.width.baseVal.value;
    canvas.height= svg.viewBox.baseVal.height || svg.height.baseVal.value;
    const ctx=canvas.getContext('2d'); ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);
    const png = canvas.toDataURL('image/png');
    URL.revokeObjectURL(url);
    done(png);
  };
  img.src = url;
}
function downloadPNG(pngDataURL, filename='relief-palette.png'){ const a=document.createElement('a'); a.download=filename; a.href=pngDataURL; a.click(); }

document.getElementById('downloadBtn').addEventListener('click', ()=>{ serializeSVGToPNG(png=>downloadPNG(png)); });
document.getElementById('copyBtn').addEventListener('click', ()=>{ navigator.clipboard.writeText(selectionSummary()).then(()=>alert('Selection copied.')); });
document.getElementById('submitBtn').addEventListener('click', ()=>{
  const email=(state.cEmail||'').trim(); const name=(state.cName||'').trim();
  if(!name){ alert('Add your name.'); return; }
  if(!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ alert('Enter a valid email.'); return; }
  serializeSVGToPNG((png)=>{
    downloadPNG(png);
    const to='info@reliefcontracting.ca';
    const subject=encodeURIComponent('Kitchen Palette Selection');
    const body=encodeURIComponent(selectionSummary() + '\n\nAttachment: please attach the downloaded PNG (relief-palette.png).');
    window.location.href=`mailto:${to}?subject=${subject}&body=${body}`;
  });
});

/* ========= FIRST RENDER ========= */
drawRun();
</script>
</body>
</html>
